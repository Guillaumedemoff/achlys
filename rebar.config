%% -*- mode: erlang;erlang-indent-level: 2;indent-tabs-mode: nil -*-
%% ex: ts=4 sw=4 ft=erlang et
{ deps , [
    % grisp ,
    {grisp , {git , "https://github.com/GrispLasp/grisp.git" , {branch , "master"}}} ,
    {epmd , {git , "https://github.com/erlang/epmd" , {ref , "4d1a59"}}} ,
    % lager ,

    % {types , {git , "https://github.com/lasp-lang/types.git" , {branch , "master"}}} ,
    % {partisan , {git , "https://github.com/lasp-lang/partisan.git" , {branch , "master"}}} ,
    % {partisan , {git , "https://github.com/barrel-db/partisan.git" , {branch , "barrel-fixes"}}} ,
    % {lasp , {git , "https://github.com/lasp-lang/lasp.git" , {branch , "master"}}}
    {lasp , {git , "https://github.com/Laymer/lasp.git" , {branch , "feature-logger"}}}
    % {lasp , {git , "https://github.com/Laymer/lasp.git" , {branch , "direct-fun-calls"}}}
    % partisan ,
    % lasp
]}.

%% == Erlang ==

{erl_opts , [
    debug_info
    % debug_info ,
    % compressed
]}.

%% == GRiSP ==

{ grisp , [
    {otp , [
        {version , "21.0"}
    ]} ,


    {build , [
        {toolchain , [
            % {directory,"/Path/To/GRiSP/grisp-software/rtems-install/rtems/5"}]}
            {directory,"/Users/laymer/GRiSP/grisp-software/rtems-install/rtems/5"}]}
    ]} ,

    {deploy , [
    % ==========
    % Linux :
    % ==========
    %     {pre_script , "rm -rf /media/user/GRISP/*"} ,
    %     {destination , "/media/user/GRISP"} ,
    %     {post_script , "umount /media/user/GRISP"}

    % ==========
    % Mac OS X :
    % ==========
        {pre_script, "rm -rf /Volumes/GRISP/*"},
        {destination, "/Volumes/GRISP"},
        {post_script, "diskutil unmount /Volumes/GRISP"}
    ]}
]}.

%% == Shell ==
{ shell , [
    {apps , []} ,
    {config , "./config/test.config"}
]}.

%% == Relx ==

{ relx , [
    {release , {achlys , "0.2.0"} , [
        % kernel ,
        % stdlib ,
        % sasl ,
        grisp ,
        {epmd , none} ,
        % lager ,
        partisan ,
        lasp ,
        syntax_tools,
        runtime_tools,
        achlys
    ]} ,
    {sys_config , "./config/sys.config"} ,
    {extended_start_script , true} ,
    {dev_mode , false} ,
    % https://github.com/erlang/rebar3/issues/1808
    {include_src, false} , % don't include source files
    {debug_info, strip} , % makes code harder to debug, but drops debug data and source info from the final beam
    {exclude_apps, [
        % lasp_support
    ]} , % list of apps that are included but you don't want (maybe wx or somehting?)
    {exclude_modules, [
        lasp_ets_storage_backend ,
        lasp_redis_storage_backend ,
        lasp_sql_lexer ,
        lasp_sql_materialized_view ,
        lasp_sql_parser ,
        lasp_state_based_synchronization_backend
        % lasp_support ,
        % tutorial ,
        % lasp_throughput_client ,
        % lasp_throughput_server
    ]} % drop modules you don't need in apps you depend on
]}.

{ profiles , [{prod , [
    {relx , [
        {dev_mode , false} ,
        {include_erts , true}
    ]} ,
    {erl_opts , [
        {d , 'GRISP' , true}
    ]}
]} ,
              {test , [
                  {dev_mode , true} ,
                  {erl_opts , [
                      nowarn_export_all ,
                      debug_info ,
                      {d , 'SHELL' , true}
                  ]} ,
                  {relx , [
                      {sys_config , "./config/test.config"}
                  ]}
              ]} ,
              {lint , [
                  {plugins , [
                      {rebar3_lint , {git , "https://github.com/project-fifo/rebar3_lint.git" , {ref , "d96949b"}}}
                  ]}
              ]}
]}.

%% == Coverage ==

{cover_enabled , true}.
{cover_opts , [verbose]}.

%% == EDoc ==

{ edoc_opts , [
    {report_missing_types , true} ,
    {source_path , ["src"]} ,
    {report_missing_types , true} ,
    {todo , true} ,
    {preprocess , true} ,
    {packages , false} ,
    {subpackages , false}
]}.

%% == Dialyzer ==

{ dialyzer , [
    {warnings , [underspecs
        ,        no_return
        ,        unmatched_returns
        ,        error_handling]} ,
    {plt_prefix , "achlys"} ,
    {plt_apps , top_level_deps} ,
    {plt_extra_apps , []} ,
    {plt_location , local} ,
    {base_plt_location , global} ,
    {base_plt_prefix , "achlys"}
]}.

%% == Xref ==

{ xref , [
    {xref_warnings , true} ,
    {xref_extra_paths , []} ,
    {xref_checks , [undefined_functions
        ,           deprecated_function_calls
        ,           undefined_function_calls
        ,           deprecated_functions]}
]}.

%% == EUnit ==

{ eunit_opts , [
    verbose ,
    {report , {eunit_surefire , [
        {dir , "./log/surefire"}
    ]}
    }
]}.
{extra_src_dirs, ["/Users/laymer/EdgeComputing/achlys/_build/default/lib/grisp/test/"]}.
